# JavaScript 常见面试题

## 原型

原型：每一个 JavaScript 对象（`null`除外）在创建时都会关联另一个对象，这个对象就是我们说的原型，每一个对象都会从原型“继承”属性。  
每一个构造函数都有一个`prototype`属性，这个属性指向了一个对象，这个对象就是调用此构造函数而创建的实例的原型。  
每一个 JavaScript 对象（`null`除外）都有一个`__proto__`属性，这个属性会指向该对象的原型。实例的`__proto__`就等于构造函数的`prototype`。  
原型链：原型也是一个对象因此也具有原型，当一个对象查找不到属性时会去原型上查找，原型查找不到时会去原型的原型上查找，一直到尽头`null`，这条链就叫原型链。

---

## 执行上下文

当 JavaScript 代码执行一段可执行代码(executable code)时，会创建对应的执行上下文(execution context)

每个执行上下文有三个重要属性：

1. 变量对象(Variable object，VO)
2. 作用域链(Scope chain)
3. this

### 变量对象

变量对象是与执行上下文相关的数据作用域，存储了在上下文中定义的变量和函数声明。

> 全局上下文中的变量对象就是全局对象。

### 函数上下文

在函数上下文中，我们用活动对象(activation object, AO)来表示变量对象。

### 执行过程

执行上下文的代码分成两个阶段处理：

1. 进入执行上下文
2. 代码执行

#### 进入执行上下文

加入形参（没有实参则`undefined`） -> 函数声明（同名则替换） -> 变量声明（同名则不会干扰）

#### 代码执行

在代码执行阶段，会顺序执行代码，根据代码修改变量对象的值。

---

### this 指向

#### 从规范理解 this

1. 计算`MemberExpression`的结果赋值给`ref`（`MemberExpression`就是`()`左边的）
2. 判断`ref`是不是一个`Reference`类型
3. 如果是且`IsPropertyReference(ref)`是`true`, 那么`this`的值为`GetBase(ref)`
4. 如果`ref`是`Reference`，并且`base value`值是`Environment Record`，那么`this`的值为`ImplicitThisValue(ref)`，也就是`undefined`
5. 如果不是，则`this`的值为`undefined`

#### 根据调用

```js
var obj = {
    a: 1,
    b: function() {
        console.log(this)
    }
}
```

1. 作为对象调用时，指向该对象 `obj.b()` // 指向obj
2. 作为函数调用， `var b = obj.b; b()` // 指向全局window
3. 作为构造函数调用 `var b = new Fun()` // this指向当前实例对象
4. 作为`call`与`apply`调用 `obj.b.apply(object, [])` // this指向当前的object

---

### 作用域链

当查找变量的时候，会先从当前上下文的变量对象中查找，如果没有找到，就会从父级(词法层面上的父级)执行上下文的变量对象中查找，一直找到全局上下文的变量对象，也就是全局对象。这样由多个执行上下文的变量对象构成的链表就叫做作用域链。

> JavaScript 是词法（静态）作用域，函数的作用域在函数定义的时候就决定了。

---

### 闭包

闭包：理论上所有的 JavaScript 函数都是闭包，从实践角度讲的话只有满足以下两点才是闭包：

1. 即使创建函数的上下文已经销毁，它仍然存在（比如内部函数从父函数中返回）。
2. 在代码中引用了自由变量（指在函数中使用的既不是函数参数也不是函数局部变量的变量）。

> 闭包的执行上下文中维护了一个作用域链，使得外层函数执行完成后闭包仍能访问到自由变量

---

### 按值传递

参数如果是基本类型是按值传递（拷贝了一份），如果是引用类型按共享传递（传递对象的引用的副本）。

基本类型的话函数内修改不成功（因为修改的是拷贝的那一份）。  
引用类型的话函数内修改若修改可访问到的（如`obj.a`）则能修改成功，若修改访问不到的属性（原先对象里没有）或修改整个对象则相当于把对象的引用的副本新指向另一处，所以原引用类型数据没有被修改。

---

### 来源

JavaScript 基础概念来源于[这里](https://github.com/mqyqingfeng/Blog)

